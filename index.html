<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A professional financial planning website with articles and calculators for smart money management.">
    <title>News Hub: Smart Finance Planner</title>

    <!-- Canonical link tag -->
    <link rel="canonical" href="https://yourwebsite.com/index.html"> 

    <!-- Open Graph Meta Tags for social media sharing -->
    <meta property="og:title" content="News Hub: Smart Finance Planner">
    <meta property="og:description" content="A professional financial planning website with articles and calculators for smart money management.">
    <meta property="og:image" content="https://placehold.co/1200x630/2563EB/ffffff?text=Smart+Finance+Planner">
    <meta property="og:url" content="https://yourwebsite.com/index.html">
    <meta property="og:type" content="website">

    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a clean, professional font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Style to hide the calculator container by default */
        .calculator-container.hidden {
            display: none;
        }

        /* Notification Modal styles */
        .notification-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .notification-modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header -->
    <header class="bg-blue-600 text-white py-12 shadow-lg relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight">News Hub</h1>
            <p class="mt-4 text-xl sm:text-2xl font-light opacity-90">Your guide to financial freedom and the latest trends.</p>
        </div>
        <nav class="mt-4 md:mt-0 flex justify-center items-center">
            <ul class="flex space-x-4 md:space-x-6 text-white">
                <li><a href="#" data-category="finance" class="nav-link text-lg font-bold border-b-2 border-white transition-colors duration-300">Finance</a></li>
                <li><a href="#" data-category="technology" class="nav-link text-lg font-medium hover:text-blue-200 transition-colors duration-300">Technology</a></li>
                <li><a href="#" data-category="entertainment" class="nav-link text-lg font-medium hover:text-blue-200 transition-colors duration-300">Entertainment</a></li>
            </ul>
        </nav>
        <!-- Notification icon and subscribe button -->
        <div class="absolute top-4 right-4 flex items-center space-x-4">
            <button id="subscribeBtn" class="bg-white text-blue-600 py-2 px-4 rounded-full text-sm font-semibold hover:bg-gray-100 transition-colors duration-200 disabled:opacity-50" title="Subscribe to real-time updates via Firebase Firestore.">
                Subscribe to Updates
            </button>
            <button id="notificationBtn" class="relative text-white hover:text-blue-200 transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-2h-2v2zm0-4h2V7h-2v6z"/>
                </svg>
                <span id="notificationBadge" class="absolute top-0 right-0 h-4 w-4 bg-red-500 rounded-full border-2 border-white transform translate-x-1 -translate-y-1 hidden"></span>
            </button>
        </div>
    </header>

    <!-- Subscription Confirmation Toast -->
    <div id="subscriptionToast" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-green-600 text-white py-3 px-6 rounded-lg shadow-lg z-50 transform scale-0 opacity-0 transition-all duration-300 ease-out">
        You are now successfully subscribed!
    </div>

    <!-- Notification Modal -->
    <div id="notificationModal" class="notification-modal-overlay">
        <div class="notification-modal-content" data-category="">
            <h3 class="text-2xl font-bold mb-4">New Update Available!</h3>
            <p id="notificationMessage" class="text-gray-600">You have a new update.</p>
            <p id="userIdDisplay" class="text-xs text-gray-400 mt-4 break-all"></p>
            <div class="mt-6 flex justify-center space-x-4">
                <a id="readNowBtn" href="#" class="bg-blue-600 text-white py-2 px-6 rounded-full font-semibold hover:bg-blue-700 transition-colors duration-200">
                    Read Now
                </a>
                <button id="closeNotificationBtn" class="bg-gray-200 text-gray-700 py-2 px-6 rounded-full font-semibold hover:bg-gray-300 transition-colors duration-200">
                    Close
                </button>
            </div>
        </div>
    </div>
    
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Articles Section -->
        <section>
            <h2 id="sectionTitle" class="text-3xl font-bold text-center text-gray-900 mb-8">Finance Articles</h2>
            <div class="card-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8" id="blogCards">
                <!-- Cards will be generated dynamically -->
            </div>
        </section>

        <!-- Dynamic Article Container -->
        <div id="articleContainer" class="bg-white rounded-xl shadow-2xl p-8 mt-12 transition-all duration-300" style="display:none;">
            <div class="mb-8">
                <img id="articleImage" src="" alt="Article image" class="w-full h-72 object-cover rounded-xl shadow-md" onerror="this.onerror=null; this.src='https://placehold.co/1024x288/E0E7FF/1E40AF?text=Image+Unavailable';">
            </div>
            <div class="article-content text-lg leading-relaxed">
                <h2 id="articleTitle" class="text-4xl font-bold text-blue-600 mb-4"></h2>
                <div id="articleText" class="prose max-w-none"></div>
            </div>
            <div id="navButtons" class="flex justify-between mt-8">
                <button id="backBtn" class="flex items-center space-x-2 bg-gray-200 text-gray-700 py-3 px-6 rounded-full font-semibold hover:bg-gray-300 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    <span>Back to Articles</span>
                </button>
                <button id="nextBtn" class="flex items-center space-x-2 bg-blue-600 text-white py-3 px-6 rounded-full font-semibold hover:bg-blue-700 transition-colors duration-200">
                    <span>Next Article</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>

        <hr class="my-12 border-t-2 border-gray-200">

        <!-- Financial Calculators Section - now conditionally visible -->
        <section id="calculatorSection" class="calculator-container bg-white rounded-xl shadow-2xl p-8 hidden">
            <h2 class="text-3xl font-bold text-center text-gray-900 mb-8">Financial Calculators</h2>
            <div class="flex flex-col lg:flex-row space-y-8 lg:space-y-0 lg:space-x-8">

                <!-- SIP Calculator -->
                <div class="calculator-card flex-1 bg-blue-50 p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-semibold text-blue-800 mb-6">SIP Calculator (Future Value)</h3>
                    <div class="calculator-input mb-6">
                        <label for="sipAmount" class="block font-medium mb-2">Monthly Investment (₹):</label>
                        <input type="number" id="sipAmount" value="5000" class="w-full p-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                    </div>
                    <div class="calculator-input mb-6">
                        <label for="sipReturn" class="block font-medium mb-2">Expected Return Rate (% p.a.):</label>
                        <input type="number" id="sipReturn" value="12" class="w-full p-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                    </div>
                    <div class="calculator-input mb-8">
                        <label for="sipYears" class="block font-medium mb-2">Time Period (Years):</label>
                        <input type="number" id="sipYears" value="10" class="w-full p-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                    </div>
                    <button class="calc-button w-full bg-blue-600 text-white py-3 rounded-md font-semibold hover:bg-blue-700 transition-colors" onclick="calculateSIP()">Calculate SIP</button>
                    <div class="calculator-result mt-6 text-center text-lg font-bold" id="sipResult"></div>
                </div>

                <!-- Lumpsum Calculator -->
                <div class="calculator-card flex-1 bg-blue-50 p-6 rounded-xl shadow-md">
                    <h3 class="text-2xl font-semibold text-blue-800 mb-6">Lumpsum Calculator (Future Value)</h3>
                    <div class="calculator-input mb-6">
                        <label for="lumpsumAmount" class="block font-medium mb-2">Total Investment (₹):</label>
                        <input type="number" id="lumpsumAmount" value="100000" class="w-full p-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                    </div>
                    <div class="calculator-input mb-6">
                        <label for="lumpsumReturn" class="block font-medium mb-2">Expected Return Rate (% p.a.):</label>
                        <input type="number" id="lumpsumReturn" value="12" class="w-full p-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                    </div>
                    <div class="calculator-input mb-8">
                        <label for="lumpsumYears" class="block font-medium mb-2">Time Period (Years):</label>
                        <input type="number" id="lumpsumYears" value="10" class="w-full p-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                    </div>
                    <button class="calc-button w-full bg-blue-600 text-white py-3 rounded-md font-semibold hover:bg-blue-700 transition-colors" onclick="calculateLumpsum()">Calculate Lumpsum</button>
                    <div class="calculator-result mt-6 text-center text-lg font-bold" id="lumpsumResult"></div>
                </div>
            </div>
        </section>

    </main>

    <footer class="mt-12 py-8 bg-gray-100 text-center text-gray-500 text-sm">
        <p>Disclaimer: This website and its content are for informational and educational purposes only. The calculators and articles are not intended to be and do not constitute financial advice. You should not make any financial decisions based on the information provided here without consulting a qualified financial professional.</p>
    </footer>

    <!-- Consolidated and Corrected JavaScript/Module Setup -->
    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Enable Firestore debug logging
        setLogLevel('debug');

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Initialize Firebase variables
        let app;
        let db;
        let auth;
        let userId = '';
        let userHasSubscribed = false;
        let authReady = false;

        // UI Elements
        const notificationBadge = document.getElementById('notificationBadge');
        const notificationModal = document.getElementById('notificationModal');
        const notificationMessage = document.getElementById('notificationMessage');
        const userIdDisplay = document.getElementById('userIdDisplay');
        const readNowBtn = document.getElementById('readNowBtn');
        const closeNotificationBtn = document.getElementById('closeNotificationBtn');
        const subscribeBtn = document.getElementById('subscribeBtn');
        const subscriptionToast = document.getElementById('subscriptionToast');
        const blogCardsContainer = document.getElementById('blogCards');
        const sectionTitle = document.getElementById('sectionTitle');
        const articleContainer = document.getElementById('articleContainer');
        const backBtn = document.getElementById('backBtn');
        const nextBtn = document.getElementById('nextBtn');
        const calculatorSection = document.getElementById('calculatorSection');

        let currentCategory = 'finance';
        let currentArticleIndex = -1;

        // Article Data (Combined and completed the missing entries)
        const articles = [
            // Finance Articles
            { id: 1, category: "finance", title: "5 Smart Financial Planning Tips for Beginners", content: "<p>One of the steps that can make you certain of your future and attainment of your goals is financial planning. The 3 simple and genius tips of financial beginners are as follows:</p><h3>1. First Budgeting: Take control the First Step.</h3><p>2. Track Your Money: There is no way you can manage something you do not measure. The first thing to be done is to know how much cash you are collecting in a month. Write down the name of all of your sources of income and each and every expense, vaguely as your rent, to that cup of coffee. This will bring you a realistic impression of your financial patterns.</h3><p>3. Prepare a Budget That Works: Use the 50/ 30/ 20 rule, 50 equals needs, 30 equals wants, 20 equals savings or debt.</p><h3>4. Debts with High Interest Rates</h3><p>5. Pay Yourself First: Save a small amount of money and then spend it first.</p>", image: "https://img.freepik.com/free-photo/finance-concept_23-2148165794.jpg" },
            { id: 2, category: "finance", title: "How to Create a Monthly Budget That Actually Works", content: "<p>Creating an effective monthly budget is both an art and a science. It's a tool that can help you take control of your money. Follow the steps below:</p><h3>1. Find Your Monthly Income</h3><p>Add up your total income from all sources. This includes your salary, freelancing income, or any other regular income.</p><h3>2. Track All Your Expenses</h3><p>Record every expense you make for a month. This includes things like rent, electricity bills, groceries, and entertainment.</p><h3>3. Implement the 50/30/20 Rule</h3><p>This is a simple budgeting rule. Spend 50% of your income on \"Needs,\" 30% on \"Wants,\" and put 20% towards \"Savings & Debt.\"</p><h3>4. Customize the Budget</h3><p>Adjust your budget according to your goals and lifestyle. If you are saving for a house, you can increase the savings portion.</p><h3>5. Review Regularly</h3><p>Review your budget monthly. See where you were successful and where you need to improve. This will help you stay on track.</p>", image: "https://img.freepik.com/free-photo/budget-planning_23-2148127345.jpg" },
            { id: 3, category: "finance", title: "Top 7 Investment Options for 2025", content: "<p>There are many investment options. Based on your financial goals and risk tolerance, you can choose from these top 7 options:</p><h3>1. Mutual Funds</h3><p>The most popular option for small investors. You can invest small amounts regularly through SIPs.</p><h3>2. Stock Market</h3><p>High return potential, but also high risk. Choose stocks of good companies for long-term investment.</p><h3>3. Government Schemes</h3><p>Options like Public Provident Fund (PPF) and National Pension Scheme (NPS) provide safe and tax-free returns.</p><h3>4. Real Estate</h3><p>A long-standing investment option. Buying property can give you both rental income and capital appreciation.</p><h3>5. Gold</h3><p>Considered a safe investment, especially during times of economic uncertainty. You can invest in physical gold or Sovereign Gold Bonds.</p><h3>6. Fixed Deposits</h3><p>A safe option for low-risk investors. You can open a fixed deposit with a bank or post office.</p><h3>7. Bonds and Debentures</h3><p>You can earn a fixed income by lending to a company or government. These are less volatile compared to mutual funds and stocks.</p>", image: "https://img.freepik.com/free-photo/indian-stock-market_23-2148189452.jpg" },
            { id: 4, category: "finance", title: "How to Build an Emergency Fund: A Complete Guide", content: "<p>An emergency fund is a financial safety net that prepares you for unexpected expenses.</p><h3>Why is it important?</h3><p>An emergency fund covers unexpected expenses like job loss, medical emergencies, or home repairs. It saves you from taking out a loan.</p><h3>How much should you save?</h3><p>Financial advisors suggest that you should save an amount equal to 3 to 6 months of living expenses.</p><h3>Where to keep the money?</h3><p>Keep it in a high-yield savings account or a short-term fixed deposit. It should be easily accessible.</p><h3>How to start?</h3><p>Set aside a fixed amount from your budget every month. Do this right after you get your salary. Start small and gradually reach your goal.</p>", image: "https://img.freepik.com/free-photo/saving-money-jar_23-2148134278.jpg" },
            { id: 5, category: "finance", title: "Retirement Planning: How Much Should You Save by Age?", content: "<p>Planning for retirement is a long journey, and the earlier you start, the better. Here are some savings tips according to your age:</p><h3>In your 20s: Start as early as possible</h3><p>At this age, you can take full advantage of the magic of compounding. Start saving 10% to 15% of your income for retirement. Investing in a SIP or a mutual fund is a good option.</p><h3>In your 30s: Increase your savings</h3><p>Your income is likely to increase in this decade. Increase your savings to 15% to 20%. Continue to invest in equity according to your risk tolerance.</p><h3>In your 40s: Review your goals</h3><p>Now is the time to review your retirement goals and see if you are on the right track. Try to increase your savings rate to 20% to 25%. Also, consider making your portfolio a little more stable.</p><h3>In your 50s: Finalize your strategy</h3><p>At this time, your goal should be to grow your savings and make your investment strategy risk-free. Start putting money into more secure investment options, such as fixed deposits or bonds.</p><h3>Conclusion</h3><p>No matter what your age is, the most important thing is to start today. Consistent savings and the right investments will help you ensure a secure retirement.</p>", image: "https://img.freepik.com/free-photo/retirement-planning-concept_23-2148165787.jpg" },
            { id: 6, category: "finance", title: "Best Tax-Saving Investments Under Section 80C", content: "<p>Section 80C of the Indian Income Tax Act allows you to save tax on investments up to ₹1.5 lakhs. Here are some popular options:</p><h3>1. Equity Linked Savings Scheme (ELSS)</h3><p>ELSS is a type of mutual fund that invests in stocks. Its lock-in period is only 3 years and it can give good returns in the long run.</p><h3>2. Public Provident Fund (PPF)</h3><p>PPF is a government scheme that provides safe and tax-free returns. Its lock-in period is 15 years and it is a good option for those who do not want to take risks.</p><h3>3. National Pension Scheme (NPS)</h3><p>NPS is a retirement plan that helps you build a large fund in the long run. It also gets additional tax benefits under Section 80C.</p><h3>4. Term Insurance</h3><p>Term insurance premiums are also tax-deductible under Section 80C. It is an essential financial safety net for your family.</p><h3>5. Fixed Deposits (Tax-Saving FDs)</h3><p>These FDs offered by banks and post offices come with a 5-year lock-in period and provide safe returns.</p>", image: "https://img.freepik.com/free-photo/tax-saving-india_23-2148291889.jpg" },
            { id: 7, category: "finance", title: "How to Improve Your Credit Score Fast", content: "<p>Your credit score determines whether you will get a loan or credit card in the future. Take these steps to improve it quickly:</p><h3>1. Pay your bills on time</h3><p>This is the most important factor of a credit score. Pay your credit card bills and loan EMIs on time.</p><h3>2. Keep your credit utilization low</h3><p>Do not use more than 30% of your total credit card limit. For example, if your credit limit is ₹1 lakh, do not spend more than ₹30,000.</p><h3>3. Keep old credit lines open</h3><p>Do not close your oldest credit cards, as this can reduce the length of your credit history.</p><h3>4. Check your credit report</h3><p>Regularly check your credit report and immediately correct any mistakes or errors.</p><h3>5. Avoid unnecessary new loans</h3><p>Do not apply for new credit cards or loans frequently. This can have a negative impact on your score.</p>", image: "https://img.freepik.com/free-photo/credit-score-india_23-2148291782.jpg" },
            { id: 8, category: "finance", title: "Why Term Insurance is a Must for Financial Security", content: "<p>Term insurance is a pure life insurance plan that provides financial security to your family for a fixed term. It is an investment that everyone should have.</p><h3>Low Cost, High Coverage</h3><p>The biggest feature of term insurance is its low premium cost. You can get a large amount of life cover by paying a small premium.</p><h3>Family Protection</h3><p>In the unfortunate event of your demise, the policy amount is given to your family. This helps your family remain financially independent and secures their future.</p><h3>Debt Repayment</h3><p>If you have a home loan or other loans, term insurance ensures that your family does not have to struggle to repay those loans after you.</p><h3>Tax Benefits</h3><p>Term insurance premiums are tax-deductible under Section 80C, and the maturity amount is also tax-free.</p>", image: "https://img.freepik.com/free-photo/insurance-concept_23-2148165739.jpg" },
            { id: 9, category: "finance", title: "Top 5 Passive Income Ideas to Grow Your Wealth", content: "<p>Passive income is income you receive with little active participation. It's a great way to grow your wealth quickly.</p><h3>1. Dividend Stocks and Mutual Funds</h3><p>Invest in the stock market and choose shares of companies that pay regular dividends. This can become a source of regular income for you.</p><h3>2. Real Estate</h3><p>Earn rental income from rented property. This is a stable and reliable source of passive income.</p><h3>3. Blogging or a YouTube Channel</h3><p>Share your knowledge and passion on a blog or YouTube channel. Once your audience grows, you can earn through advertisements, sponsorships, and affiliate marketing.</p><h3>4. Peer-to-Peer Lending</h3><p>Lend to other individuals through a digital platform and earn interest. This is a new and attractive option.</p><h3>5. Sell Digital Products</h3><p>Create and sell digital products like e-books, online courses, or stock photos. Once created, they can be sold again and again.</p>", image: "https://img.freepik.com/free-photo/passive-income-ideas_23-2148189712.jpg" },
            { id: 10, category: "finance", title: "Financial Mistakes to Avoid in Your 20s and 30s", content: "<p>Your 20s and 30s are crucial for laying the foundation of your financial future. Avoid these common mistakes:</p><h3>1. Delaying Savings</h3><p>Starting to save and invest early gives you the full benefit of compounding. Avoid the mindset of \"I'll do it tomorrow.\"</p><h3>2. Taking Expensive Loans</h3><p>Avoid high-interest loans like credit card debt or personal loans. They can become the biggest hurdle in your financial progress.</p><h3>3. Not Building an Emergency Fund</h3><p>Without an emergency fund, unexpected expenses can force you to take out a loan. Start saving from your salary immediately.</p><h3>4. Ignoring Insurance</h3><p>Consider health and term insurance as an investment, not an expense. It protects you from financial crises.</p><h3>5. Spending More Than Your Income</h3><p>Stick to your budget. Do not spend on unnecessary things due to social pressure.</p>", image: "https://img.freepik.com/free-photo/young-adults-financial-mistakes_23-2148165769.jpg" },
            
            // Technology Articles (New)
            { id: 11, category: "technology", title: "The Future of AI in Everyday Life", content: "<p>Artificial Intelligence is no longer a futuristic concept; it's being integrated into our daily lives. From smart home devices to personalized recommendations on streaming platforms, AI is everywhere. The next decade will see AI become even more seamless, anticipating our needs and automating complex tasks, transforming everything from healthcare to transportation.</p><h3>AI in Healthcare</h3><p>AI is being used to analyze medical images, predict disease outbreaks, and even assist in surgery. This is leading to faster diagnoses and more personalized treatment plans for patients.</p><h3>AI in Transportation</h3><p>Self-driving cars are just the beginning. AI is set to revolutionize logistics, public transit, and even air travel, making it safer and more efficient.</p><h3>AI and Personalization</h3><p>Imagine a smart assistant that not only organizes your calendar but also suggests the most efficient way to achieve your goals based on your habits. AI will take personalization to a new level, making our lives more convenient.</p>", image: "https://img.freepik.com/free-photo/ai-human-hand-touching-cyborg-s-hand-glowing-blue-light_23-2149479344.jpg" },
            { id: 12, category: "technology", title: "The Rise of Quantum Computing", content: "<p>Quantum computing uses the principles of quantum mechanics to process information, allowing it to solve problems that are currently impossible for even the most powerful supercomputers. While still in its infancy, it holds the potential to revolutionize fields like cryptography, drug discovery, and material science.</p><h3>How is it Different?</h3><p>Classical computers use bits (0s and 1s) to store data. Quantum computers use qubits, which can represent 0, 1, or both at the same time, thanks to a property called superposition. This allows them to perform complex calculations at an exponential speed.</p><h3>Challenges Ahead</h3><p>Despite its promise, quantum computing faces significant challenges, including the need for extremely low temperatures and the fragility of qubits. However, ongoing research is making rapid progress, bringing a quantum future closer to reality.</p>", image: "https://img.freepik.com/free-photo/quantum-computer-processor_23-2149187654.jpg" },
            { id: 13, category: "technology", title: "Cybersecurity Best Practices for 2025", content: "<p>As our digital world expands, so do cybersecurity threats. Protecting your personal and financial data is more critical than ever. Here are some key best practices to follow in 2025.</p><h3>1. Use Strong, Unique Passwords</h3><p>Avoid using simple passwords or reusing the same password across multiple sites. Use a password manager to securely store complex, unique passwords for all your accounts.</p><h3>2. Enable Multi-Factor Authentication (MFA)</h3><p>MFA adds an extra layer of security, requiring a second form of verification (like a code from your phone) in addition to your password. This is one of the most effective ways to protect your accounts from unauthorized access.</p><h3>3. Be Cautious of Phishing Scams</h3><p>Phishing attacks are becoming increasingly sophisticated. Be wary of suspicious emails or messages asking for personal information. Always verify the sender's identity and never click on unverified links.</p><h3>4. Keep Your Software Updated</h3><p>Software updates often include critical security patches. Make sure to regularly update your operating system, web browser, and other applications to protect against known vulnerabilities.</p><h3>5. Back Up Your Data</p><p>Regularly back up your important data to a secure cloud service or external drive. This protects you in case of a ransomware attack or a device failure.</p>", image: "https://img.freepik.com/free-photo/cybersecurity-concept_23-2149176374.jpg" },
            { id: 14, category: "technology", title: "The Latest in Renewable Energy Tech", content: "<p>The shift to renewable energy sources is accelerating, driven by innovation in solar, wind, and geothermal technologies. Here's a look at the latest advancements.</p><h3>1. Perovskite Solar Cells</h3><p>These new solar cells are cheaper to produce and more efficient at converting sunlight into electricity, making solar energy more accessible to the masses.</p><h3>2. Floating Wind Farms</h3><p>Floating offshore wind turbines can be deployed in deep waters where traditional wind farms are not feasible, unlocking a massive potential for clean energy generation.</p><h3>3. Geothermal Power Advances</h3><p>New drilling techniques are making geothermal energy more viable by allowing access to high-temperature rock formations deeper underground, providing a constant source of power.</p>", image: "https://img.freepik.com/free-photo/renewable-energy-concept_23-2149169420.jpg" },
            { id: 15, category: "technology", title: "5G vs. 6G: What's the Next Frontier?", content: "<p>5G is rolling out globally, but the research community is already looking ahead to 6G. While 5G promises faster speeds and lower latency, 6G aims to create an even more connected world.</p><h3>What to Expect from 6G</h3><p>6G is envisioned to support speeds of up to 1 Tbps, enabling instant, real-time communication for holographic calls and immersive virtual reality experiences. It will also be designed to be more energy-efficient and to connect billions of devices simultaneously.</p><h3>The Role of AI</h3><p>AI will be a fundamental part of the 6G network, helping to manage traffic, optimize performance, and ensure a seamless connection for all devices, from smartphones to smart cities.</p>", image: "https://img.freepik.com/free-photo/6g-network-concept_23-2149216752.jpg" },

            // Entertainment Articles (New)
            { id: 16, category: "entertainment", title: "The Best Movies of 2025 (So Far)", content: "<p>2025 has been a fantastic year for cinema. From mind-bending sci-fi to heartwarming dramas, here are some of the standout films that have critics and audiences buzzing.</p><h3>1. 'Cosmic Whispers'</h3><p>A stunning visual spectacle, this sci-fi epic follows a lone astronaut's journey to a distant galaxy. The film's use of practical effects and a haunting score make it a must-see for all fans of the genre.</p><h3>2. 'Echoes of a Dream'</h3><p>A powerful drama that explores themes of loss and reconciliation. The lead performance is a career-best, delivering a performance that is both subtle and emotionally devastating.</p><h3>3. 'The Laugh Factory'</h3><p>The year's funniest comedy, 'The Laugh Factory' is a non-stop riot that pokes fun at the absurdities of modern life. It's a hilarious and surprisingly poignant film that will leave you wanting more.</p>", image: "https://img.freepik.com/free-photo/movie-clapperboard_23-2147774218.jpg" },
            { id: 17, category: "entertainment", title: "Top 10 Must-Watch TV Shows This Season", content: "<p>The golden age of television is alive and well, with a flood of new shows and returning favorites. Here are the top 10 shows you should be binge-watching right now.</p><h3>1. 'The Chronos Directive'</h3><p>A gripping time-travel thriller that keeps you on the edge of your seat. The complex plot and unexpected twists make it a show you'll be thinking about long after the credits roll.</p><h3>2. 'Royal Rumble'</h3><p>A period drama that offers a fresh take on historical events, 'Royal Rumble' is a beautifully shot and acted series that will transport you to a different era.</p><h3>3. 'Street Beats'</h3><p>A documentary series that explores the history of hip-hop music. 'Street Beats' features exclusive interviews and archival footage that give you a deep look into the evolution of the genre.</p>", image: "https://img.freepik.com/free-photo/television-set_23-2147773297.jpg" },
            { id: 18, category: "entertainment", title: "Music Trends of 2025: What's Hot and What's Not", content: "<p>The music landscape is constantly changing, and 2025 has seen some exciting new trends emerge. From the revival of classic genres to the rise of new artists, here's what's making waves.</p><h3>1. The Return of Funk</h3><p>Funk music is back in a big way, with new artists blending classic grooves with modern production. The result is a sound that's both nostalgic and fresh.</p><h3>2. DIY Music Production</h3><p>Thanks to accessible technology, more artists are producing their own music from home. This has led to a boom in independent artists who are creating unique and experimental sounds.</p><h3>3. The Rise of 'S-pop'</h3><p>Following the global success of K-pop, 'S-pop' (Spanish-language pop) is gaining a huge following. Artists from Latin America and Spain are dominating the charts with catchy beats and powerful vocals.</p>", image: "https://img.freepik.com/free-photo/music-trends_23-2148169421.jpg" },
            { id: 19, category: "entertainment", title: "Gaming Spotlight: The Most Anticipated Games of the Year", content: "<p>Gaming is bigger than ever, and 2025 is set to be a landmark year with a lineup of highly anticipated games that promise to push the boundaries of technology and storytelling.</p><h3>1. 'Galactic Frontier'</h3><p>This space-faring RPG gives players an entire galaxy to explore. The game's intricate lore, deep customization options, and dynamic combat system make it a contender for Game of the Year.</p><h3>2. 'The Last Kingdom'</h3><p>A brutal and beautiful open-world survival game set in a post-apocalyptic world. Players must scavenge for resources, craft weapons, and build a settlement to survive against all odds.</p><h3>3. 'Pixel Party'</h3><p>A charming and colorful multiplayer game that's perfect for a night in with friends. The game's simple-to-learn mechanics and competitive mini-games make it a blast to play.</p>", image: "https://img.freepik.com/free-photo/gaming-controller_23-2148165768.jpg" },
            { id: 20, category: "entertainment", title: "The Evolution of Streaming Services", content: "<p>Streaming services have completely changed how we watch movies and TV. As the market becomes more crowded, these services are evolving to stay ahead of the competition.</p><h3>1. The Rise of 'Hybrid' Services</h3><p>Many services are now offering a mix of ad-supported and ad-free tiers, giving consumers more choice. This has also led to a return to live sports and news on streaming platforms.</p><h3>2. Focus on Original Content</h3><p>To attract and retain subscribers, services are investing heavily in original content. This has led to a creative boom, with more high-quality and unique shows and movies being produced than ever before.</p><h3>3. A Push for Personalization</h3><p>Streaming platforms are using AI to offer hyper-personalized recommendations. They are also creating new features, like interactive shows and personalized homepages, to enhance the viewing experience.</p>", image: "https://img.freepik.com/free-photo/streaming-service-concept_23-2148169422.jpg" }
        ];

        // --- Utility Functions ---

        /**
         * Formats a number as Indian currency (Rupees) with commas.
         * @param {number} number The number to format.
         * @returns {string} The formatted currency string.
         */
        function formatCurrency(number) {
            const num = Math.round(number);
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 0
            }).format(num);
        }

        /**
         * Shows the subscription confirmation toast.
         */
        function showToast() {
            subscriptionToast.classList.remove('scale-0', 'opacity-0');
            subscriptionToast.classList.add('scale-100', 'opacity-100');
            setTimeout(() => {
                subscriptionToast.classList.remove('scale-100', 'opacity-100');
                subscriptionToast.classList.add('scale-0', 'opacity-0');
            }, 3000);
        }

        // --- Financial Calculator Logic ---

        window.calculateSIP = function() {
            const P = parseFloat(document.getElementById('sipAmount').value);
            const r_annual = parseFloat(document.getElementById('sipReturn').value);
            const t_years = parseFloat(document.getElementById('sipYears').value);

            if (isNaN(P) || isNaN(r_annual) || isNaN(t_years) || P <= 0 || t_years <= 0) {
                document.getElementById('sipResult').innerHTML = '<span class="text-red-600">Please enter valid values.</span>';
                return;
            }

            // Calculations
            const n_months = t_years * 12;
            const i_monthly = (r_annual / 100) / 12;

            let futureValue;

            if (i_monthly === 0) {
                // Simple case if interest rate is 0
                futureValue = P * n_months;
            } else {
                // Future Value of Annuity Due (assuming investment happens at the start of the month)
                // FV = P * [ ((1 + i)^n - 1) / i ] * (1 + i)
                futureValue = P * ((Math.pow(1 + i_monthly, n_months) - 1) / i_monthly) * (1 + i_monthly);
            }
            
            const investedAmount = P * n_months;
            const wealthGained = futureValue - investedAmount;

            document.getElementById('sipResult').innerHTML = `
                <div class="space-y-2">
                    <p class="text-xl text-blue-800">Maturity Value: <span class="text-green-600">${formatCurrency(futureValue)}</span></p>
                    <p class="text-sm text-gray-600">Total Invested: ${formatCurrency(investedAmount)}</p>
                    <p class="text-sm text-gray-600">Wealth Gained: ${formatCurrency(wealthGained)}</p>
                </div>
            `;
        }

        window.calculateLumpsum = function() {
            const P = parseFloat(document.getElementById('lumpsumAmount').value);
            const r_annual = parseFloat(document.getElementById('lumpsumReturn').value);
            const t_years = parseFloat(document.getElementById('lumpsumYears').value);

            if (isNaN(P) || isNaN(r_annual) || isNaN(t_years) || P <= 0 || t_years <= 0) {
                document.getElementById('lumpsumResult').innerHTML = '<span class="text-red-600">Please enter valid values.</span>';
                return;
            }

            // Calculations
            const r_decimal = r_annual / 100;
            // Compound Interest Formula: A = P * (1 + r)^t
            const futureValue = P * Math.pow(1 + r_decimal, t_years);

            const wealthGained = futureValue - P;

            document.getElementById('lumpsumResult').innerHTML = `
                <div class="space-y-2">
                    <p class="text-xl text-blue-800">Maturity Value: <span class="text-green-600">${formatCurrency(futureValue)}</span></p>
                    <p class="text-sm text-gray-600">Total Invested: ${formatCurrency(P)}</p>
                    <p class="text-sm text-gray-600">Wealth Gained: ${formatCurrency(wealthGained)}</p>
                </div>
            `;
        }

        // --- Article Display Logic ---

        /**
         * Renders the filtered articles as cards.
         * @param {string} category The category to filter by.
         */
        function displayArticles(category) {
            currentCategory = category;
            const filteredArticles = articles.filter(a => a.category === category);
            
            // Update UI visibility
            articleContainer.style.display = 'none';
            blogCardsContainer.parentElement.style.display = 'block';

            if (category === 'finance') {
                calculatorSection.classList.remove('hidden');
            } else {
                calculatorSection.classList.add('hidden');
            }

            // Update title
            sectionTitle.textContent = `${category.charAt(0).toUpperCase() + category.slice(1)} Articles & Tools`;

            // Render cards
            blogCardsContainer.innerHTML = filteredArticles.map(article => `
                <div class="article-card bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden cursor-pointer" data-id="${article.id}">
                    <img src="${article.image}" alt="${article.title}" class="w-full h-48 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/600x300/E0E7FF/1E40AF?text=Image+Unavailable';">
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-2">${article.title}</h3>
                        <p class="text-gray-600 text-sm">${article.content.substring(0, 100).replace(/<[^>]*>?/gm, '')}...</p>
                        <a href="#" class="mt-4 inline-block text-blue-600 font-semibold hover:text-blue-800 transition-colors" data-id="${article.id}">Read More &rarr;</a>
                    </div>
                </div>
            `).join('');

            // Attach click listeners to cards/links
            document.querySelectorAll('.article-card, .article-card a').forEach(element => {
                element.addEventListener('click', (e) => {
                    e.preventDefault();
                    // Get the ID from the card or the link's data-id
                    const id = e.currentTarget.dataset.id || e.currentTarget.closest('.article-card').dataset.id;
                    const index = filteredArticles.findIndex(a => a.id == id);
                    if (index !== -1) {
                        showArticle(index);
                    }
                });
            });
        }

        /**
         * Displays the full content of a specific article.
         * @param {number} index The index of the article in the current filtered list.
         */
        function showArticle(index) {
            const filteredArticles = articles.filter(a => a.category === currentCategory);
            if (index < 0 || index >= filteredArticles.length) return;

            currentArticleIndex = index;
            const article = filteredArticles[index];

            document.getElementById('articleTitle').textContent = article.title;
            document.getElementById('articleText').innerHTML = article.content;
            document.getElementById('articleImage').src = article.image;

            // Update navigation buttons state
            backBtn.style.display = 'flex';
            nextBtn.style.display = (index < filteredArticles.length - 1) ? 'flex' : 'none';
            
            // Show article, hide card grid/calculators
            blogCardsContainer.parentElement.style.display = 'none';
            calculatorSection.classList.add('hidden');
            articleContainer.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // --- Firebase/Auth/Firestore Logic ---

        // 1. Initialization and Authentication Setup
        if (Object.keys(firebaseConfig).length > 0) {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Sign in with custom token or anonymously
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                    } else {
                        // Sign in anonymously if no token is available
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (e) {
                            console.error("Auth failed:", e);
                        }
                    }

                    if (!authReady) {
                        authReady = true;
                        console.log("Firebase Auth Ready. User ID:", userId);
                        userIdDisplay.textContent = `User ID: ${userId}`;
                        // Initial data load/listeners start only once auth is ready
                        await getSubscriptionStatus();
                        listenForNotifications();
                    }
                });
            } catch (e) {
                console.error("Failed to initialize Firebase:", e);
            }
        } else {
            console.warn("Firebase config is missing. App running in mock mode.");
        }


        // 2. Subscription Management (Private Data)
        const getSubscriptionDocRef = (uid) => doc(db, `artifacts/${appId}/users/${uid}/profile/subscription`);

        /**
         * Loads the user's subscription status from Firestore.
         */
        async function getSubscriptionStatus() {
            if (!db || !userId) return;
            try {
                const docRef = getSubscriptionDocRef(userId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    userHasSubscribed = docSnap.data().subscribed || false;
                } else {
                    // Create the doc if it doesn't exist, defaulting to false
                    await setDoc(docRef, { subscribed: false });
                    userHasSubscribed = false;
                }
                updateSubscriptionButton();
            } catch (e) {
                console.error("Error reading subscription status:", e);
            }
        }

        /**
         * Updates the user's subscription status in Firestore.
         */
        async function setSubscriptionStatus(status) {
            if (!db || !userId) return;
            try {
                const docRef = getSubscriptionDocRef(userId);
                await setDoc(docRef, { subscribed: status }, { merge: true });
                userHasSubscribed = status;
                updateSubscriptionButton();
                if (status) {
                    showToast();
                }
            } catch (e) {
                console.error("Error updating subscription status:", e);
            }
        }

        /**
         * Updates the UI state of the subscribe button.
         */
        function updateSubscriptionButton() {
            if (userHasSubscribed) {
                subscribeBtn.textContent = 'Subscribed (Updates ON)';
                subscribeBtn.classList.remove('bg-white', 'text-blue-600', 'hover:bg-gray-100');
                subscribeBtn.classList.add('bg-green-500', 'text-white', 'hover:bg-green-600');
                subscribeBtn.disabled = true;
            } else {
                subscribeBtn.textContent = 'Subscribe to Updates';
                subscribeBtn.classList.remove('bg-green-500', 'text-white', 'hover:bg-green-600');
                subscribeBtn.classList.add('bg-white', 'text-blue-600', 'hover:bg-gray-100');
                subscribeBtn.disabled = false;
            }
        }


        // 3. Real-time Public Notifications

        /**
         * Sets up a real-time listener for new public notifications.
         */
        function listenForNotifications() {
            if (!db) return;
            const publicCollectionPath = `artifacts/${appId}/public/data/notifications`;
            const q = doc(db, publicCollectionPath, 'latest'); // Check only for the 'latest' document

            // Use exponential backoff for retries
            const maxRetries = 5;
            let currentRetry = 0;

            const attemptListen = () => {
                try {
                    onSnapshot(q, (docSnapshot) => {
                        if (docSnapshot.exists() && userHasSubscribed) {
                            const notification = docSnapshot.data();
                            // Check if a recent notification exists
                            if (notification.timestamp && Date.now() - notification.timestamp.toMillis() < (60 * 60 * 1000)) {
                                updateNotificationUI(notification);
                            }
                        }
                    }, (error) => {
                        console.error("Error listening to notifications:", error);
                        handleSnapshotError();
                    });
                } catch (e) {
                    console.error("Snapshot setup failed:", e);
                    handleSnapshotError();
                }
            };
            
            const handleSnapshotError = () => {
                if (currentRetry < maxRetries) {
                    const delay = Math.pow(2, currentRetry) * 1000;
                    currentRetry++;
                    // Silence console logs for retries to avoid unnecessary noise
                    // console.warn(`Retrying listener in ${delay}ms... (Attempt ${currentRetry})`);
                    setTimeout(attemptListen, delay);
                } else {
                    console.error("Maximum retries reached. Notification listener stopped.");
                }
            };

            attemptListen();
        }

        let lastNotification = null;

        /**
         * Updates the notification badge and modal content.
         * @param {object} notification The notification document data.
         */
        function updateNotificationUI(notification) {
            if (!notification || !userHasSubscribed) return;

            // Only show if the notification ID is different from the last one seen
            if (lastNotification && lastNotification.id === notification.id) return;

            notificationBadge.classList.remove('hidden');
            notificationMessage.textContent = notification.message || "A new article has been published!";
            notificationModal.setAttribute('data-article-id', notification.articleId || -1);
            notificationModal.setAttribute('data-category', notification.category || currentCategory);
            
            lastNotification = notification;
        }

        // --- Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Initial Load: Display Finance articles by default
            displayArticles('finance');

            // 2. Navigation Links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const category = e.target.getAttribute('data-category');
                    if (category) {
                        displayArticles(category);
                        // Update active link style
                        document.querySelectorAll('.nav-link').forEach(l => {
                            l.classList.remove('font-bold', 'border-b-2', 'border-white');
                            l.classList.add('font-medium', 'hover:text-blue-200');
                        });
                        e.target.classList.remove('font-medium', 'hover:text-blue-200');
                        e.target.classList.add('font-bold', 'border-b-2', 'border-white');
                    }
                });
            });

            // 3. Article Navigation Buttons
            backBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const filteredArticles = articles.filter(a => a.category === currentCategory);
                if (currentArticleIndex > 0) {
                    showArticle(currentArticleIndex - 1);
                } else {
                    // Go back to the main article grid
                    displayArticles(currentCategory);
                }
            });

            nextBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const filteredArticles = articles.filter(a => a.category === currentCategory);
                if (currentArticleIndex < filteredArticles.length - 1) {
                    showArticle(currentArticleIndex + 1);
                }
            });

            // 4. Subscription Button
            subscribeBtn.addEventListener('click', () => {
                if (db && userId) {
                    setSubscriptionStatus(true);
                } else {
                    console.error("Firebase not ready or User ID missing.");
                }
            });

            // 5. Notification Modal Controls
            notificationBtn.addEventListener('click', () => {
                if (!notificationBadge.classList.contains('hidden')) {
                    notificationModal.style.display = 'flex';
                }
            });

            closeNotificationBtn.addEventListener('click', () => {
                notificationModal.style.display = 'none';
            });

            readNowBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const articleId = notificationModal.getAttribute('data-article-id');
                const category = notificationModal.getAttribute('data-category');
                
                if (articleId != -1) {
                    // Switch to the correct category view
                    document.querySelectorAll('.nav-link').forEach(l => {
                        if (l.getAttribute('data-category') === category) {
                            l.click(); // This will call displayArticles(category)
                        }
                    });

                    // Find the article index in the new filtered list
                    const filteredArticles = articles.filter(a => a.category === category);
                    const index = filteredArticles.findIndex(a => a.id == articleId);
                    
                    if (index !== -1) {
                        showArticle(index);
                    }
                }

                // Clear the notification badge after clicking read now
                notificationModal.style.display = 'none';
                notificationBadge.classList.add('hidden');
                // You might also want to log this read status to Firestore here if needed
            });
        });

        // Initialize SIP and Lumpsum on load
        window.onload = () => {
            if (document.getElementById('sipAmount')) calculateSIP();
            if (document.getElementById('lumpsumAmount')) calculateLumpsum();
        }

    </script>
</body>
</html>
